<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>iterative-solver: Library Design</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">iterative-solver
   &#160;<span id="projectnumber">.</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md____w_iterative_solver_iterative_solver_doc_LibraryDesign.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Library Design </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md19"></a>
Iterative solvers</h1>
<h2><a class="anchor" id="autotoc_md20"></a>
Solver interfaces and implementations</h2>
<p>There are 4 types of solvers. They share a very similar functionality and their common interface is expressed in IterativeSolver base class.</p>
<p>Each type of solver can have multiple implementations.</p>
<p><img src="images/solvers.png" alt="SolversHirearchyDiagram" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md21"></a>
Dependency inversion mechanism</h2>
<p>Solvers are templated on container type so that the user can choose optimal container for their problem. This requires two sets of dependency inversion.</p>
<p>Firstly, dense linear algebra operations are wrapped up in <code>DenseLinearAlgebra</code> class, which depends on the type of container elements. This can be time consuming to compile so it is specialised for <code>double</code> and <code>std::complex</code>.</p>
<p>Secondly, <code>ArrayHandlers</code> defines the interface for operation on containers such as copying, linear algebra, lazy evaluation etc. <code>ArrayHandlers</code> is a collection of <code>ArrayHandler</code> abstract classes. There are implementations of <code>ArrayHandler</code> for common container types, but for more specialised cases the user must provide their own.</p>
<p><img src="images/dependency_inversion.png" alt="SolversHirearchyDiagram" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md22"></a>
Setting solver Options</h2>
<p>There are setters and getters for setting the options, but they require complete type of the object to be known. This might not be possible if the user is working with solver through the interface. Working through the interface can be necessary to reduce compilation time and minimize header bloat.</p>
<p>Instead options can be set in the <code>Options</code> class and then passed to <code>IterativeSolver::set_options()</code> which will call setters internally. Similarly calling <code>IterativeSolver::get_options()</code> returns a pointer to the <code>Options</code> class and the user can query their values.</p>
<p>Options classes are organised in a hierarchy that mirrors inheritance structure of iterative solvers (see above). At the lowest level are options for each implementation of a solver and they contain all of the available options that can be set, including for interface classes.</p>
<p><img src="images/options.png" alt="SolverOptionsDiagram" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md23"></a>
Solver Factory</h2>
<p><code>SolverFactory</code> allows dynamic creation of a solver. It takes an implementation options object by reference and deduces the corresponding solver with dynamic casts. This is the main reason why the options hierarchy mirrors that of solvers.</p>
<p><img src="images/solver_factory.png" alt="SolverFactoryDiagram" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md24"></a>
Distributed Arrays</h1>
<p>In parallel computing it is often necessary to distribute an array over multiple processes. Each process stores a small section of the array without overlapping. There are multiple implementations of this approach including Global Arrays, MPI3 windows, parallel HDF5 and others. We provide a simple interface to different implementations of distributed arrays to allow cross-compatibility and simplify their usage.</p>
<p>There are three aspects to consider:</p><ol type="1">
<li>distribution across processes and access to the local section</li>
<li>linear algebra operations that require only local sections</li>
<li>remote memory access (RMA) operations for accessing data on a different process</li>
</ol>
<p>The distribution can be defined using <a class="el" href="classmolpro_1_1linalg_1_1array_1_1util_1_1Distribution.html" title="Specifies distribution of a contiguous array into non-overlapping chunks.">molpro::linalg::array::util::Distribution</a> and the abstract class <a class="el" href="classmolpro_1_1linalg_1_1array_1_1DistrArray.html" title="Array distributed across many processes supporting remote-memory-access, access to process local buff...">molpro::linalg::array::DistrArray</a> defines common functionality such as checking that two distributed arrays are compatible and accessing the local buffer.</p>
<p>The linear algebra operations only require local sections and can be supported by all distributed arrays. However, some implementations can use more efficient algorithms (e.g. buffering local section in chunks when loading from disk), so the linear algebra operations have to be virtual functions in the base class.</p>
<p>Not all implementation can or need to support RMA operations, however most will. We decided to make RMA operations part of the abstract base class, even though they might not always be implemented thus breaking the Liskov substitution principle. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
